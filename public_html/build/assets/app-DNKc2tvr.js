var R=Object.defineProperty;var v=s=>{throw TypeError(s)};var j=(s,e,t)=>e in s?R(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var S=(s,e,t)=>j(s,typeof e!="symbol"?e+"":e,t),w=(s,e,t)=>e.has(s)||v("Cannot "+t);var o=(s,e,t)=>(w(s,e,"read from private field"),t?t.call(s):e.get(s)),u=(s,e,t)=>e.has(s)?v("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t);var p=(s,e,t)=>(w(s,e,"access private method"),t);import{a as B,m as A,R as M,i as C,S as T}from"./app-CYfS_It_.js";window.axios=B;window.Alpine=A;A.start();window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";async function b(s,e,t=5e3){await T.fire({title:s,type:e,timer:t})}var i;class x{static init(){const e=document.querySelectorAll(o(this,i).commentBtn),t=document.querySelector(o(this,i).modal);t&&e.forEach(r=>r.addEventListener("click",n=>this.handleReplyClick(r,t)))}static handleReplyClick(e,t){const r=e.dataset.comment,n=e.dataset.iteration;t.querySelector(o(this,i).commentParent).value=r;const a=document.getElementById(n),{src:h}=a.querySelector(o(this,i).commentAvatar),l=a.querySelector(o(this,i).commentAuthor).textContent,g=a.querySelector(o(this,i).commentMessage).innerHTML,m=t.querySelector(o(this,i).replyAvatar),H=t.querySelector(o(this,i).replyAuthor),F=t.querySelector(o(this,i).replyMessage);m.src=h,m.alt=l,H.textContent=l,F.innerHTML=g}}i=new WeakMap,u(x,i,{commentBtn:".reply_comment_btn",modal:"#comment_modal",commentParent:".comment_parent",commentAvatar:".comment_avatar",commentAuthor:".comment_author",commentMessage:".comment_message",replyAvatar:"#replyToAvatar",replyAuthor:"#replyToAuthor",replyMessage:"#replyToMessage"});const k={MESSAGES:{success:"با موفقیت انجام شد",validationError:"موارد مورد نیاز را به درستی وارد کنید",serverError:"در فرآیند ثبت درخواست شما مشکلی به‌وجود آمده‌است، لطفا بعدا تلاش کنید",successSchema:"فرم با موفقیت ثبت شد"},init(){this.bindFormEvents()},bindFormEvents(){document.querySelectorAll(".formMode").forEach(e=>{const t=this.handleSubmit.bind(this);e.addEventListener("submit",t),e._submitHandler=t})},cleanup(){document.querySelectorAll(".formMode").forEach(e=>{e._submitHandler&&(e.removeEventListener("submit",e._submitHandler),delete e._submitHandler)})},async handleSubmit(s){s.preventDefault();const e=s.target,t=e.querySelector('button[type="submit"]'),r=t.innerHTML;this.setButtonState(t,!0,"wait ...");const n=this.createResponseElement(e);try{n.textContent="please wait",await this.submitForm(e,n),this.handleSuccess(e,n)}catch(a){this.handleError(e,n,a)}finally{this.setButtonState(t,!1,r);const a=e.querySelector(".recaptcha-image");a&&(a.src=await new M().fetchNewCaptcha())}},modifyUrl(s,e="ajax"){const t=new URL(s);return t.pathname=`/${e}${t.pathname}`,t.toString()},async submitForm(s,e){const t=this.modifyUrl(s.action),r=new FormData(s);return(await axios.post(t,r)).data},setButtonState(s,e,t){s.innerHTML=t,s.disabled=e,s.style.cursor=e?"wait":""},createResponseElement(s){let e=s.querySelector(".form_responseEl");return e||(e=document.createElement("div"),e.classList.add("form_responseEl"),s.appendChild(e)),e},handleSuccess(s,e){e.innerHTML='<span class="form-success">با موفقیت انجام شد</span>',this.showAlert("فرم با موفقیت ثبت شد","success"),s.reset();const t=s.closest(".form-box");t&&(t.innerHTML=this.getSuccessSchema())},handleError(s,e,t){var r;if(((r=t.response)==null?void 0:r.status)===422){const n=t.response.data.errors;this.highlightInvalidFields(s,n),this.displayValidationErrors(e,n),this.showAlert(this.MESSAGES.validationError,"warning")}else e.innerHTML='<span class="form-error">در فرآیند ثبت درخواست شما مشکلی به‌وجود آمده‌است، لطفا بعدا تلاش کنید</span>',this.showAlert(this.MESSAGES.serverError,"error")},highlightInvalidFields(s,e){s.querySelectorAll(".input-error-msg").forEach(t=>t.remove()),s.querySelectorAll(".input_validation-error").forEach(t=>t.classList.remove("input_validation-error")),Object.entries(e).forEach(([t,r])=>{const n=s.querySelector(`[name="${t}"]`);n&&(n.classList.add("input_validation-error"),errorEl.classList.add("input-error-msg"),errorEl.style.color="red",errorEl.style.fontSize="0.875rem",errorEl.textContent=r[0],n.insertAdjacentElement("afterend",errorEl))})},displayValidationErrors(s,e){const t=Object.entries(e).map(([r,n])=>`<li>${n}</li>`).join("");s.innerHTML=`<ul class="form-error-list">${t}</ul>`},showAlert(s,e){b(s,e)},getSuccessSchema(){return`
            <div class="form-success-container">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="form-success-icon">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
                <span class="form-success-text">${this.MESSAGES.successSchema}</span>
            </div>`}};class ${constructor(){S(this,"buttons");S(this,"offsets");this.buttons=document.querySelectorAll(".load_more"),this.offsets=new Map,this.init()}init(){this.buttons.forEach((e,t)=>{this.offsets.set(e,1),e.addEventListener("click",this.handleClick.bind(this),{once:!1})})}async handleClick(e){e.preventDefault();const t=e.currentTarget,r=this.getButtonAttributes(t);if(!this.validateAttributes(r)){console.error("Missing required button attributes");return}const{classModel:n,identify:a,destination:h,parentIdBox:l}=r,g=document.querySelector(`#${l}`);if(!g){console.error(`Parent element #${l} not found`);return}try{const m=await this.fetchData(h,this.offsets.get(t),n,a);this.handleResponse(m,g,t)}catch(m){console.error("Failed to load more content:",m),b("something goes wrong","error")}}getButtonAttributes(e){return{classModel:e.dataset.bind,identify:e.dataset.identify,destination:e.dataset.destination,parentIdBox:e.dataset.target}}validateAttributes(e){return Object.values(e).every(t=>t!=null)}async fetchData(e,t,r,n){const a=new URL(e);return a.searchParams.append("offset",t),a.searchParams.append("bind",r),a.searchParams.append("identify",n),(await axios.get(a.toString())).data.data}handleResponse(e,t,r){e!=null&&e.length?(t.insertAdjacentHTML("beforeend",e),this.offsets.set(r,this.offsets.get(r)+1)):r.remove()}}var d,y,f,c,L,E,q;class D{constructor(e={}){u(this,c);u(this,d,new Map);u(this,y,"/ajax/client-submitting/gadget");u(this,f,2);this.gadgets=[],this.endpoint=e.endpoint||o(this,y),this.maxRetries=e.maxRetries||o(this,f)}async init(){if(this.gadgets=document.querySelectorAll("gadget"),!this.gadgets.length)return;const e=document.createDocumentFragment(),t=Array.from(this.gadgets).map(r=>p(this,c,L).call(this,r));try{(await Promise.all(t.map(n=>p(this,c,E).call(this,n)))).forEach(({gadget:n,response:a},h)=>{var l;(l=a==null?void 0:a.data)!=null&&l.data&&p(this,c,q).call(this,n,a.data.data,e)}),document.body.appendChild(e)}catch(r){console.error("Failed to load gadgets:",r)}}cleanup(){this.gadgets=[],o(this,d).clear()}}d=new WeakMap,y=new WeakMap,f=new WeakMap,c=new WeakSet,L=function(e){const t=Object.fromEntries(Array.from(e.attributes).map(r=>[r.name,r.value]));return{gadget:e,data:{attributes:t,innerContent:e.innerHTML}}},E=async function(e,t=1){try{const r=JSON.stringify(e.data);if(o(this,d).has(r))return{...e,response:o(this,d).get(r)};const n=await axios.post(this.endpoint,e.data,{timeout:5e3});return o(this,d).set(r,n),{...e,response:n}}catch(r){return t<o(this,f)?p(this,c,E).call(this,e,t+1):(console.warn(`Failed to fetch gadget data after ${t} attempts:`,r),{...e,response:null})}},q=function(e,t,r){try{const n=document.createElement("div");n.innerHTML=t;const a=e.parentNode;a&&(r.appendChild(n),a.replaceChild(n,e))}catch(n){console.error("Failed to load gadget:",n)}};const _=new D({endpoint:"/ajax/client-submitting/gadget",maxRetries:3});_.init();_.cleanup();document.addEventListener("DOMContentLoaded",function(s){x.init(),k.init(),new $,new M,C()});
